# Shai-Hulud 2 - The Second Coming…
November 24, 2025

Somewhere around 11/21/25 the internet saw the continuation of the Shai-Hulud worm. Many articles, and the malware authors themselves, have called this “the second coming”. By now there are several blogs about this recent attack circulating from both established security research firms and individuals. Much like my previous article on the first [Shai-Hulud sighting](/articles/2025-09-18-shai-hulud.md) I wanted to take some time to publish information that I found during my preliminary analysis of the on-going attack.

### Initial Observations:
1. Overall this "second coming" of the Shai-Hulud worm we saw back in September appears to be much more effective. It also appears to have compromised a wider range of individuals and credentials. 
2. The malicious file (bun_environment.js) contained in a given compromised package is heavily obfuscated and over 11mb in size making analysis difficult. From my preliminary analysis I can see the code is heavily nested.
3. Some victims had multiple repositories created while others only had one. I believe this might be due to the number of compromised packages that a particular victim is using. The more compromised npm packages a victim is using, the more fraudulent repos containing their credentials are created. This is just a preliminary thought I had and have yet to confirm.
4. When compared to the first Shai-Hulud worm, this Shai-Hulud-2 worm posts compromised data to public git repositories rather than relying on a hard-coded webhook.site URL or a hard-coded repository name.

### Primary Payload:
There are already some really good blog posts detailing the malware code. I enjoyed reading this one by some researchers at Wiz, [Shai-Hulud 2.0 Supply Chain Attack: 25K+ npm Repos Exposed](https://www.wiz.io/blog/shai-hulud-2-0-ongoing-supply-chain-attack). I want to take a deeper dive into the code itself at some point but for now you can go check out the linked article to learn more about how Shai-hulud-2 works.

The payload is located in the fraudulent "bun_environment.js" file. This file contains more than 11MB of obfuscated code.

Much like the previous Shai-Hulud worm, the Shai-Hulud-2 malware appears to utilize [trufflehog](https://github.com/trufflesecurity/trufflehog), a popular secrets Discovery, Classification, Validation, and Analysis tool, to find and validate secrets within a compromised repository.

### Basic Attack Flow - Based on my Observations so Far:
1. The victim utilizes a compromised NPM package in their project

2. The compromised npm package executes malicious functions to fingerprint the host and run trufflehog which would be used to find developer and CI/CD secrets to GitHub repositories.

3. The compromised creds are posted to a randomly named public git repo created on behalf of the victim user under the victim's GitHub account. Compromised data is stored across several files (cloud.json, contents.json, environment.json, actionsSecrets.json, and truffleSecrets.json).

4. The attackers can then grab the files containing the compromised data via a simple github search (path:"FILE_NAME").


### What Information is Stored in Each File?
- truffleSecrets.json --> secrets obtained from the trufflehog tool
- cloud.json --> secrets from AWS, GCP, or Azure
- contents.json --> information about the compromised platform
- environments.json --> environment variables from the compromised system
- actionsSecrets.json --> Lists all secrets defined in GitHub secrets

### Examples of Compromise:
I found several examples of users who were compromised by this shai-hulud-2 malware. Below are some screenshots that show what a compromised repo looked like. A compromised repository would contain the following indicators:
1. A randomly generated repository name 
2. A description in the About section containing the text "Sha1-Hulud: The Second Coming"
3. Several commits with the description “Add file”

Here is the rough number of repos that the Shai-Hulud-2 worm created so far. Note that the total number is 24 thousand!
![shai-hulud-2-number-of-compromised-repos](/images/shai-hulud-2/shai-hulud-2-number-of-compromised-repos.png)

A compromised account would look like this. Note the number of public repositories (there are 4 in this example) with randomly generated names that have been created on behalf of the victim.
![compromised-repo](/images/shai-hulud-2/compromised-repo.png)

A compromised repository would look like this. Note the text in the "About" section and the commit descriptions.
![inside-a-compromised-repo](/images/shai-hulud-2/inside-a-compromised-repo.png)

Here is a look at the GitHub Workflow configuration file that is added to a victim repository. Note the actions that it adds. After this workflow is added the attackers can interact with the victim repository by opening discussions. The attackers can use this as a backdoor to exfiltrate secrets from the hosted GitHub Workflow Runner.
![discussion-yaml-config](/images/shai-hulud-2/discussion-yaml-config.png)

---
Here are examples of the contents of each of the files that are used to store compromised data:

contents.json --> Contains information about the compromised platform
```json
{
  "system": {
    "platform": "linux",
    "architecture": "x64",
    "platformDetailed": "linux",
    "architectureDetailed": "x64",
    "hostname": "runner-set-s-qnw64-0",
    "os_user": {
      "homedir": "/home/runner",
      "username": "unknown",
      "shell": "unknown",
      "uid": 1000,
      "gid": 1000
    }
  },
  "modules": {
    "github": {
      "authenticated": true,
      "token": "REDACTED",
      "username": {
        "login": "REDACTED",
        "name": "REDACTED",
        "email": null,
        "publicRepos": 161,
        "followers": 21,
        "following": 18,
        "createdAt": "2011-08-13T22:11:47Z"
      }
    }
  }
}
```

actionsSecrets.json --> Contains all secrets defined in GitHub secrets
```json
[
  {
    "github_token": "REDACTED",
    "BETA_ORIGIN": "https://beta.REDACTED.com",
    "VERCEL_PREVIEW_PROJECT_ID": "REDACTED",
    "VERCEL_PROJECT_ID": "REDACTED",
    "PREVIEW_ORIGIN": "https://preview.REDACTED.com",
    "PREVIEW_DATABASE_URL": "postgresql://postgres.REDACTED:REDACTED@aws-1-us-east-1.pooler.REDACTED.com:6543/postgres",
    "PREVIEW_API_BASE": "https://preview-api.REDACTED.com",
    "VERCEL_TOKEN": "REDACTED",
    "GATED_ENDPOINT": "/v1/gated/ping",
    "PROD_DATABASE_URL": "postgresql://postgres.REDACTED:REDACTED@aws-0-us-east-1.pooler.REDACTED.com:6543/postgres",
    "RENDER_API_KEY": "REDACTED",
    "PREVIEW_HEADER_TOKEN": "REDACTED",
    "PROD_API_BASE": "https://api.REDACTED.com",
    "DATABASE_URL": "postgresql://postgres.REDACTED:REDACTED@aws-0-us-east-1.pooler.REDACTED.com:6543/postgres",
    "E2E_ADMIN_PASSWORD": "REDACTED",
    "PREVIEW_WEB": "https://preview.REDACTED.com",
    "VERCEL_ORG_ID": "REDACTED",
    "PREVIEW_STAFF_CODE": "REDACTED",
    "E2E_INSTRUCTOR_PASSWORD": "REDACTED",
    "WEBHOOK_ENDPOINT": "/webhooks/stripe/payment-events",
    "BGC_ENCRYPTION_KEY": "REDACTED=",
    "VERCEL_PRODUCTION_PROJECT_ID": "REDACTED",
    "PREVIEW_BASE_URL": "https://preview.REDACTED.com",
    "BETA_BASE_URL": "https://beta.REDACTED.com",
    "CODECOV_TOKEN": "REDACTED"
  }
]
```

Showing other examples of compromised secrets found in actionsSecrets.json
```json
[
  {
    "AWS_SECRET_ACCESS_KEY_XID_DEV": "REDACTED",
    "github_token": "REDACTED",
    "CLAUDE_CODE_OAUTH_TOKEN": "REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID_ENT": "REDACTED",
    "PYTHON_COMMONS_ACCESS_TOKEN": "REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_ENT": "REDACTED",
    "PP_ENG_INTERNAL_PAT": "REDACTED",
    "TEST_SECRET": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID": "REDACTED",
    "STUDIO_GITHUB_TOKEN": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_DEV": "REDACTED",
    "SONAR_HOST_URL": "https://sonarqube.REDACTED",
    "WAZUH_TOKEN": "REDACTED"
  },
  {
    "AWS_SECRET_ACCESS_KEY_XID_DEV": "REDACTED",
    "github_token": "REDACTED",
    "AWS_ROLE_ARN_DEV": "arn:aws:iam::REDACTED:role/REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID_ENT": "REDACTED",
    "PYTHON_COMMONS_ACCESS_TOKEN": "REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_ENT": "REDACTED",
    "PP_ENG_INTERNAL_PAT": "REDACTED",
    "TEST_SECRET": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID": "REDACTED",
    "STUDIO_GITHUB_TOKEN": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_DEV": "REDACTED",
    "SONAR_HOST_URL": "https://sonarqube.REDACTED",
    "AWS_ROLE_ARN_ENT": "arn:aws:iam::REDACTED:role/REDACTED\n",
    "SLACK_WEBHOOK_URL": "https://hooks.slack.com/services/REDACTED",
    "WAZUH_TOKEN": "REDACTED"
  },
  {
    "AWS_SECRET_ACCESS_KEY_XID_DEV": "REDACTED",
    "ARGOCD_AUTH_TOKEN": "REDACTED",
    "NOTION_SECRET": "REDACTED",
    "github_token": "REDACTED",
    "CLAUDE_CODE_OAUTH_TOKEN": "REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID_ENT": "REDACTED",
    "PYTHON_COMMONS_ACCESS_TOKEN": "REDACTED",
    "REPO_ACCESS_TOKEN": "REDACTED",
    "AWS_SECRET_ACCESS_KEY_XID": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_ENT": "REDACTED",
    "LICENSE_AUTH_TOKEN": "REDACTED",
    "PP_ENG_INTERNAL_PAT": "REDACTED",
    "AWS_SECRET_ACCESS_KEY": "REDACTED",
    "DEV_NOTION_SECRET": "REDACTED",
    "TEST_SECRET": "REDACTED",
    "PALO_ALTO_API_KEY": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID": "REDACTED",
    "STUDIO_GITHUB_TOKEN": "REDACTED",
    "AWS_ACCESS_KEY_ID_XID_DEV": "REDACTED",
    "SONAR_HOST_URL": "https://sonarqube.REDACTED",
    "AWS_ACCESS_KEY_ID": "REDACTED",
    "TERRAFORM_MODULES_TOKEN": "REDACTED",
    "WORKFLOW_TRIGGER_TOKEN": "REDACTED",
    "SLACK_WEBHOOK_URL": "https://REDACTED/api/slack/webhook",
    "WAZUH_TOKEN": "REDACTED"
  },
  ...
]
```

environment.json --> Contains environment variables from the compromised system
```json
{
  "environment": {
    "ECR_REGISTRY_PREVIEW": "REDACTED",
    "GITHUB_STATE": "/runner/_work/_temp/_runner_file_commands/save_state_c267c670-15ee-4655-8559-3ca4da895eaf",
    "KUBERNETES_SERVICE_PORT": "443",
    "KUBERNETES_PORT": "tcp://REDACTED:443",
    "npm_package_dev": "",
    "npm_config_user_agent": "npm/11.6.0 node/v24.8.0 linux x64 workspaces/false ci/github-actions",
    "CI": "true",
    "HOSTNAME": "runner-set-s-qnw64-0",
    "RUNNER_ENVIRONMENT": "self-hosted",
    "GITHUB_ENV": "/runner/_work/_temp/_runner_file_commands/set_env_c267c670-15ee-4655-8559-3ca4da895eaf",
    "npm_node_execpath": "/opt/hostedtoolcache/node/24.8.0/x64/bin/node",
    "npm_package_resolved": "https://registry.npmjs.org/@postman/tunnel-agent/-/tunnel-agent-0.6.7.tgz",
    "GITHUB_ACTIONS_RUNNER_EXTRA_USER_AGENT": "actions-runner-controller/v0.27.6",
    "RUNNER_EPHEMERAL": "true",
    "SHLVL": "4",
    "npm_config_noproxy": "",
    "HOME": "/home/runner",
    "OLDPWD": "/tmp",
    "npm_package_optional": "",
    "RUNNER_ORG": "REDACTED",
    "RUNNER_TEMP": "/runner/_work/_temp",
    "GITHUB_EVENT_PATH": "/runner/_work/_temp/_github_workflow/event.json",
    "npm_package_json": "/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/@postman/tunnel-agent/package.json",
    "DOCKER_ENABLED": "true",
    "GITHUB_REPOSITORY_OWNER": "REDACTED",
    "npm_package_engines_node": "*",
    "RUNNER_WORKDIR": "/runner/_work",
    "GITHUB_RETENTION_DAYS": "90",
    "GITHUB_REPOSITORY_OWNER_ID": "REDACTED",
    "GITHUB_HEAD_REF": "REDACTED",
    "npm_config_userconfig": "/home/runner/.npmrc",
    "npm_config_local_prefix": "/runner/_work/REDACTED/REDACTED",
    "npm_package_integrity": "sha512-8tLdJQAFOYmmAkXI5ADBsNz+qbB4HbkKcPSREn3Fl11SAH9ogM6j7qd7q4XUp4lY/Re47PXEN3XJKXDKOivIDg==",
    "ACTIONS_RUNNER_HOOK_JOB_STARTED": "/opt/get-instance-metadata.sh",
    "DISABLE_RUNNER_UPDATE": "true",
    "GITHUB_GRAPHQL_URL": "https://api.github.com/graphql",
    "COLOR": "0",
    "GITHUB_URL": "https://github.com/",
    "RUNNER_ASSETS_DIR": "/runnertmp",
    "AWS_STS_REGIONAL_ENDPOINTS": "regional",
    "RUNNER_OS": "Linux",
    "GITHUB_API_URL": "https://api.github.com",
    "RUNNER_LABELS": "k8s-ci,k8s-ci-small,k8s-ci-prod-small,k8s-ci-prod-neptune-small",
    "AWS_DEFAULT_REGION": "us-east-1",
    "_": "/opt/hostedtoolcache/node/24.8.0/x64/bin/npm",
    "RUNNER_GROUP": "",
    "GITHUB_WORKFLOW": "E2E",
    "npm_config_prefix": "/opt/hostedtoolcache/node/24.8.0/x64",
    "npm_config_npm_version": "11.6.0",
    "GITHUB_RUN_ID": "19628675496",
    "npm_config_cache": "/home/runner/.npm",
    "GITHUB_REF_TYPE": "branch",
    "RUSTUP_HOME": "/home/runner/rustup",
    "GITHUB_WORKFLOW_SHA": "2acf5a08b534d4024a1d0060c4de7c46eefbbc25",
    "KUBERNETES_PORT_443_TCP_ADDR": "172.20.0.1",
    "GITHUB_BASE_REF": "develop",
    "AWS_EC2_INSTANCE_NAME": "ip-10-55-59-84.us-east-2.compute.internal",
    "ImageOS": "ubuntu22",
    "GITHUB_WORKFLOW_REF": "REDACTED/REDACTED/.github/workflows/e2e.yml@refs/pull/55830/merge",
    "GITHUB_ACTION_REPOSITORY": "",
    "npm_config_node_gyp": "/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",
    "PATH": "/home/runner/.bun/bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/@postman/tunnel-agent/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/@postman/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/node_modules/.bin:/opt/hostedtoolcache/node/node_modules/.bin:/opt/hostedtoolcache/node_modules/.bin:/opt/node_modules/.bin:/node_modules/.bin:/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/opt/hostedtoolcache/Ruby/3.4.5/x64/bin:/opt/hostedtoolcache/node/24.8.0/x64/bin:/home/runner/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/runner/.local/bin/",
    "RUNNER_TRACKING_ID": "github_9754eb30-2cc4-468f-85a2-d1057ba07d8e",
    "RUNNER_TOOL_CACHE": "/opt/hostedtoolcache",
    "NODE": "/opt/hostedtoolcache/node/24.8.0/x64/bin/node",
    "npm_package_name": "@postman/tunnel-agent",
    "GITHUB_ACTION": "__run_6",
    "GITHUB_RUN_NUMBER": "189795",
    "GITHUB_TRIGGERING_ACTOR": "REDACTED",
    "RUNNER_ARCH": "X64",
    "KUBERNETES_PORT_443_TCP_PORT": "443",
    "REDACTED_CI_BUILDS_S3_BUCKET": "REDACTED",
    "KUBERNETES_PORT_443_TCP_PROTO": "tcp",
    "RUNNER_GRACEFUL_STOP_TIMEOUT": "3500",
    "AWS_CONTAINER_CREDENTIALS_FULL_URI": "http://REDACTED/v1/credentials",
    "RUNNER_NAME": "runner-set-s-qnw64-0",
    "GITHUB_REF_NAME": "REDACTED",
    "GITHUB_REPOSITORY": "REDACTED/REDACTED",
    "npm_lifecycle_script": "node setup_bun.js",
    "DOCKER_GROUP_GID": "121",
    "GITHUB_ACTION_REF": "",
    "DEBIAN_FRONTEND": "noninteractive",
    "npm_config_global": "true",
    "GITHUB_REPOSITORY_ID": "REDACTED",
    "GITHUB_ACTIONS": "true",
    "npm_package_version": "0.6.7",
    "npm_lifecycle_event": "preinstall",
    "ACTIONS_RUNNER_HOOK_JOB_COMPLETED": "/etc/arc/hooks/job-completed.sh",
    "AWS_REGION": "us-east-1",
    "GITHUB_REF_PROTECTED": "false",
    "GITHUB_WORKSPACE": "/runner/_work/REDACTED/REDACTED",
    "GITHUB_JOB": "api-integration",
    "RUST_VERSION": "1.84",
    "GITHUB_SHA": "REDACTED",
    "GITHUB_RUN_ATTEMPT": "1",
    "DOCKER_HOST": "unix:///run/docker.sock",
    "npm_package_dev_optional": "",
    "KUBERNETES_SERVICE_PORT_HTTPS": "443",
    "GITHUB_REF": "refs/pull/55830/merge",
    "KUBERNETES_PORT_443_TCP": "tcp://172.20.0.1:443",
    "GITHUB_ACTOR": "REDACTED",
    "DOCKERD_IN_RUNNER": "false",
    "npm_config_globalconfig": "/opt/hostedtoolcache/node/24.8.0/x64/etc/npmrc",
    "npm_config_init_module": "/home/runner/.npm-init.js",
    "npm_package_peer": "",
    "GITHUB_PATH": "/runner/_work/_temp/_runner_file_commands/add_path_c267c670-15ee-4655-8559-3ca4da895eaf",
    "PWD": "/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/REDACTED/node_modules/@postman/tunnel-agent",
    "GITHUB_ACTOR_ID": "224519504",
    "KUBERNETES_SERVICE_HOST": "172.20.0.1",
    "RUNNER_WORKSPACE": "/runner/_work/REDACTED",
    "DOCKER_CONFIG": "/runner/_work/_temp/docker_login_1763975006593",
    "npm_execpath": "/opt/hostedtoolcache/node/24.8.0/x64/lib/node_modules/npm/bin/npm-cli.js",
    "AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE": "/var/run/secrets/pods.eks.amazonaws.com/serviceaccount/eks-pod-identity-token",
    "CARGO_HOME": "/home/runner/cargo",
    "GITHUB_EVENT_NAME": "pull_request",
    "GITHUB_SERVER_URL": "https://github.com",
    "GITHUB_OUTPUT": "/runner/_work/_temp/_runner_file_commands/set_output_c267c670-15ee-4655-8559-3ca4da895eaf",
    "npm_config_global_prefix": "/opt/hostedtoolcache/node/24.8.0/x64",
    "TOOLBOX_ARTIFACT_S3_BUCKET": "ci-eks-prod-us-east-2-artifacts",
    "RUNNER_STATUS_UPDATE_HOOK": "false",
    "npm_command": "install",
    "BRANCH_NAME": "REDACTED",
    "RUNNER_ENTERPRISE": "",
    "GITHUB_STEP_SUMMARY": "/runner/_work/_temp/_runner_file_commands/step_summary_c267c670-15ee-4655-8559-3ca4da895eaf",
    "INIT_CWD": "/runner/_work/REDACTED/REDACTED",
    "EDITOR": "vi"
  }
}
```

truffleSecrets.json --> Contains all of the secrets obtained from the trufflehog tool
```json
{
  "findings": [
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/0/5/8/b/2/058b2da965552d2afc3f912a1aff37c0bd43f2600bb340b32285d2c3.body",
            "line": 148
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/4/6/8/b/8/468b8fe8b4ce9ab8806e2bbe2b80ecca49a2c93c6f3b81b8a671ce4b.body",
            "line": 186
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationError": "http: server gave HTTP response to HTTPS client",
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.bun/bin/bun",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 917,
      "DetectorName": "Aiven",
      "DetectorDescription": "Aiven is a managed cloud service that provides various open-source data infrastructure services. Aiven API keys can be used to access and manage these services.",
      "DecoderName": "UTF16",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.bun/bin/bun",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 414,
      "DetectorName": "TomorrowIO",
      "DetectorDescription": "TomorrowIO is a weather intelligence platform providing weather data and insights. TomorrowIO API keys can be used to access and retrieve weather information.",
      "DecoderName": "UTF16",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/5/a/9/a/9/5a9a9e6ff15ada17b10d0d7d42e242f92710806ba68f1660b5047881.body",
            "line": 183
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationError": "lookup localhost2 on 172.20.0.10:53: no such host",
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/5/a/9/a/9/5a9a9e6ff15ada17b10d0d7d42e242f92710806ba68f1660b5047881.body",
            "line": 180
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationError": "dialing local IP addresses is not allowed",
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/c/0/3/3/9c03367168b65e5d74ecc5bdf69be1ba6d54392510d670993fe40b46.body",
            "line": 199
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/d/c/0/8/9dc087bd20e72af0d1c1ecf035786f4a832a7a0632d58f958a4d35be.body",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "-----BEGIN PRIVATE KEY-----\nREDACTED\n-----END PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/d/c/0/8/9dc087bd20e72af0d1c1ecf035786f4a832a7a0632d58f958a4d35be.body",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "BASE64",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/d/c/0/8/9dc087bd20e72af0d1c1ecf035786f4a832a7a0632d58f958a4d35be.body",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "-----BEGIN PRIVATE KEY-----\nREDACTED\n-----END PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/b/0/9/3/3/b0933bd76d22bb9f4b547a96163998d15d04cb2f1c17fe2f8b88fb39.body",
            "line": 23
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 492,
      "DetectorName": "Pastebin",
      "DetectorDescription": "Pastebin is a website where users can store plain text. Pastebin keys can be used to access and manipulate stored data.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/d/c/0/8/9dc087bd20e72af0d1c1ecf035786f4a832a7a0632d58f958a4d35be.body",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "-----BEGIN PRIVATE KEY-----\nREDACTED\n-----END PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/d/c/0/8/9dc087bd20e72af0d1c1ecf035786f4a832a7a0632d58f958a4d35be.body",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.cache/pip/http-v2/9/c/0/3/3/9c03367168b65e5d74ecc5bdf69be1ba6d54392510d670993fe40b46.body",
            "line": 50
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 242,
      "DetectorName": "Polygon",
      "DetectorDescription": "Polygon is a protocol and a framework for building and connecting Ethereum-compatible blockchain networks. Polygon API keys can be used to interact with its services and access blockchain data.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.dev-env/externals/node20/bin/node",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 917,
      "DetectorName": "Aiven",
      "DetectorDescription": "Aiven is a managed cloud service that provides various open-source data infrastructure services. Aiven API keys can be used to access and manage these services.",
      "DecoderName": "UTF16",
      "Verified": false,
      "VerificationFromCache": false,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.dev-env/externals/node24/bin/node",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 917,
      "DetectorName": "Aiven",
      "DetectorDescription": "Aiven is a managed cloud service that provides various open-source data infrastructure services. Aiven API keys can be used to access and manage these services.",
      "DecoderName": "UTF16",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/botocore/__pycache__/httpsession.cpython-311.pyc",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/botocore/data/location/2020-11-19/service-2.json.gz",
            "line": 50
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 242,
      "DetectorName": "Polygon",
      "DetectorDescription": "Polygon is a protocol and a framework for building and connecting Ethereum-compatible blockchain networks. Polygon API keys can be used to interact with its services and access blockchain data.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "REDACTED",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/botocore/httpsession.py",
            "line": 199
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 17,
      "DetectorName": "URI",
      "DetectorDescription": "This detector identifies URLs with embedded credentials, which can be used to access web resources without explicit user interaction.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "REDACTED",
      "RawV2": "REDACTED",
      "Redacted": "REDACTED",
      "ExtraData": null,
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/2_7_keycert.pem",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN PRIVATE KEY-----\nREDACTED\n-----END PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/badcert.pem",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/badcert.pem",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/keycert.pem",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "BASE64",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/server.key",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "PLAIN",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN PRIVATE KEY-----\nREDACTED\n-----END PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/wrongcert.pem",
            "line": 1
          }
        }
      },
      "SourceID": 1,
      "SourceType": 15,
      "SourceName": "trufflehog - filesystem",
      "DetectorType": 15,
      "DetectorName": "PrivateKey",
      "DetectorDescription": "Private keys are used for securely connecting and authenticating to various systems and services. Exposure of private keys can lead to unauthorized access and data breaches.",
      "DecoderName": "BASE64",
      "Verified": false,
      "VerificationFromCache": true,
      "Raw": "-----BEGIN RSA PRIVATE KEY-----\nREDACTED\n-----END RSA PRIVATE KEY-----\n",
      "RawV2": "",
      "Redacted": "REDACTED",
      "ExtraData": {},
      "StructuredData": null
    },
    {
      "SourceMetadata": {
        "Data": {
          "Filesystem": {
            "file": "/home/runner/.local/lib/python3.11/site-packages/gevent/tests/test_server.key",
            "line": 1
          }
        }
    ...
  ],
  "executionTime": 35205,
  "exitCode": 0,
  ...
  ]
}

```

cloud.json --> Contatins secrets from AWS, GCP, or Azure (I didnt find any so I am showing how the file is structured.)
```json
{
  "aws": {
    "secrets": []
  },
  "gcp": {
    "secrets": []
  },
  "azure": {
    "secrets": []
  }
}
```

### How I got a sample of the Shai-Hulud-2 Malware:
After learning about the on-going Shai-Hulud-2 attack I spun up a docker container and pulled down some of the compromised packages to see if I could extract the malicious payload. I saw some blog posts like [Shai-Hulud 2.0 Supply Chain Attack: 25K+ npm Repos Exposed](https://www.wiz.io/blog/shai-hulud-2-0-ongoing-supply-chain-attack) [published by researchers at Wiz] and Charlie Eriksen’s [Shai Hulud Launches Second Supply-Chain Attack: Zapier, ENS, AsyncAPI, PostHog, Postman Compromised](https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains) that all contained lists of compromised npm packages. The git repository https://github.com/Cobenian/shai-hulud-detect was also extremely helpful in listing the currently compromised packages and some analysis of the current malware.

After I pulled down some compromised npm packages I looked for the `bun_environment.js` file which contained the malware.

### How to Protect Yourself:
1. Look through npm dependencies in your project(s) and verify whether any of them were compromised.
2. Rotate credentials and enforce MFA for developer and CI/CD accounts.
3. Look for new repositories in your GitHub organization containing “Sha1-Hulud” in the description and remove them.
    - use this GitHub search: `in:description "Sha1-Hulud"`

### Final Thoughts:
It's pretty obvious that the creators of Shai-Hulud-2 took lessons learned from the first versions of the Shai-Hulud worm that ransacked the npm community a few months ago. The malicious actors chose to push the compromised credentials to randomly named GitHub repositories rather than try to exfiltrate the data silently via a malicious server. The former is more simplistic and gets the job done. However, it's quite obvious who got owned. The latter is more stealthy and inherently more dangerous but much more difficult to execute. I find it extremely interesting that we get to see this worm develop over the course of several months and I have no doubt that we will see another version again soon. I wonder what Shai-Hulud-3 is going to look like…
